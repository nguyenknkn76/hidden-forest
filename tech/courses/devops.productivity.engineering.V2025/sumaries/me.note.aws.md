# AWS 

## CREATE VPC
- s1: create new vpc /16 default
- s2: create subnet  /24 vpc 
  - public subnet
    example: 
    - vpc: your main vpc
    - name: dop10-public-sn
    - az: a 
    - sn: 10.11.0.2/24
  - private subnet
  - database subnet 
- s3: create route tables
  - public route table 
    - edit sub associations
    - edit routes: 0.0.0.0 -> internet gateway
      - create internet gateways > attach ur main vpc
  - private route table 
    - edit routes: 
- s4: edit network connection

## CREATE EC2
dop10-ec2-public
- create ec2
  - dop-public-ec2
    - image: ubuntu,...
    - instance type: t3 micro -> COST 
    - key pair: access EC2 (can reuse or use 3 key pair ~ public, private, db) -> dop10-public-ec2-kp
    - network: ur vpc
    - subnet: ur subnet
    - auto assign public ip
    - security group: (diff public, private, db) 
      - dop10-public-sg
      - inbound: ssh 22 anywhere (sus have to use custom > add list public ip)
      - outbound:
    - storage: 8gb
    - temp: none advanced
  - dop-private-ec2 
    - diff keypair: private-ec2-kp
    - auto assign public ip > disable
    - sec group:
      - can reuse
      - best practise: using another sec group
  - dop-database

## 3 Requirements

- internet can access public sub
```bash
ping public-ip

ssh - i "private-key-file.pem" ubuntu@public-ip > ubuntu@private-ip

# can ssh 22
# can NOT ping -> reason using port 22 to ssh -> fix choose inbound rules: all trafics -> myip

mv private-key-file.pem ~

chmod 400 private-key-file.pem

scp -i private-key-file.pem ./need-cp-file.pem ubuntu@public-ip:home/nguyentdk
```
- ec2 public can access private, database (internal)
- ec2 private can access database
- ec2 private, database can access internet but this is one way. internet can't access database

## Elastic IP 

- Create
- Associate

## NAT Gateway

-
-

- edit routes > 0.0.0.0 -> NAT Gateway

> note: NAT in route table `PUBLIC`

## VPN

- access from internet to private instance 

- create VPN 
  - AMI > Market > OpenVPN (subcribe) ~ 2 connections in 1 time.
  - type: t2 small (at least)
  - public subnet
  - enable Auto-assign public IP | elastic ip 
  - security group: ... fixed auto require be generated by OpenVPN image
  - storage: 20gb 

- access admin account in 'OpenVPN' browser > create profile > download profile aka token > download app 
- create 2 user: 'OpenVPN' browser > User Management > User permissions

## NOTE

- public instance: 2 IPs ---> public ip, private ip
- double check config: EC2 instance, etc


/home/nguyentdk02/user/code/learning/dop.devops/inclass/aws/04.aws.secrets/ec2.instance.keypairs

ssh -i "dop10-ec2-public-kp.pem" ubuntu@3.35.50.243

dop10-ec2-public-kp.pem
dop10-ec2-private-kp.pem
dop10-ec2-database-kp.pem

